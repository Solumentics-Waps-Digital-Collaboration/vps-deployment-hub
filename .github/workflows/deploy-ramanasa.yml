name: Deploy Ramanasa.com

on:
  workflow_dispatch:  # YOU manually trigger from GitHub UI

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Stage 1 - Connection Check
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: ${{ secrets.VPS_PORT }}
          script: |
            echo "âœ… Connected to VPS successfully!"
            echo "Server: $(hostname)"
            echo "User: $(whoami)"
      
      - name: ğŸ”„ Stage 2 - Prepare Deployment
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: ${{ secrets.VPS_PORT }}
          script: |
            echo "ğŸ“¦ Preparing deployment environment..."
            cd /var/www/deployment-hub/sites/ramanasa
            chmod +x deploy.sh
            echo "âœ… Ready to deploy!"
      
      - name: ğŸ—ï¸ Stage 3 - Clone & Build
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: ${{ secrets.VPS_PORT }}
          script: |
            echo "ğŸ”¨ Cloning repo and building site..."
            cd /var/www/deployment-hub/sites/ramanasa
            ./deploy.sh
      
      - name: ğŸš€ Stage 4 - Deploy to Production
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: ${{ secrets.VPS_PORT }}
          script: |
            echo "ğŸ“¤ Website deployed to /var/www/sites/ramanasa"
            echo "ğŸŒ Nginx is now serving ramanasa.com"
      
      - name: âœ… Stage 5 - Verification
        run: |
          echo "========================================="
          echo "ğŸ‰ Deployment Complete!"
          echo "ğŸŒ Live at: https://ramanasa.com"
          echo "â° Deployed: $(date)"
          echo "========================================="